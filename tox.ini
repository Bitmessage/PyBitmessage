[tox]
envlist = reset,py{27,27-portable,36,38,39},stats
skip_missing_interpreters = true

[testenv]
setenv =
    BITMESSAGE_HOME = {envtmpdir}
    PYTHONWARNINGS = default
deps = -rrequirements.txt
commands =
    python checkdeps.py
    coverage run -a src/bitmessagemain.py -t
    coverage run -a -m tests

[testenv:py27-doc]
deps =
    .[docs]
    -r docs/requirements.txt
commands = python setup.py build_sphinx

[testenv:py27-portable]
skip_install = true
commands = python pybitmessage/bitmessagemain.py -t

[testenv:reset]
deps =
    coverage
    bandit
    flake8
commands =
    coverage erase
    bandit -r --exit-zero -s B105,B301,B411,B413,B608 \
    -x checkdeps.*,bitmessagecurses,bitmessageqt,tests pybitmessage
    flake8 pybitmessage --count --select=E9,F63,F7,F82 \
    --show-source --statistics

[testenv:stats]
deps = coverage
commands =
    coverage report
    coverage xml

[coverage:run]
source = src
omit =
    */lib*
    tests.py
    */tests/*
    src/version.py
    */__init__.py
    src/fallback/umsgpack/*

[coverage:report]
ignore_errors = true
